---
title: &displayMap store
---

## Summary

The `&displayMap` store specifies a mapping file for on screen keyboard display
data, used at compile time to transform text on the key caps to an alternate
encoding.

## Syntax

```keyman
store(&displayMap) 'KbdXxxx.json'
```

## Description

The `&displayMap` store specifies a mapping file, relative to the keyboard
source file, which provides data for remapping the touch layout and visual
keyboard key caps. This file has no impact on output from the keyboard; it is
used only for on screen keycap presentation.

The primary purpose of this file is to provide a pathway for consistent display
of diacritics and other unattached marks which may be displayed on either type
of on screen keyboard, by use of a special font with formatted glyphs in the
Private Use Area. This makes it possible to guarantee consistent display across
all platforms, as rendering of unattached marks is somewhat platform-specific
and font-specific.

This file can be generated by `kmc analyze osk-char-use` command, or hand
crafted. The compiler uses only the `str` and `pua` values in the file, although
there may be additional data in the file provided for reference purposes. The
file should have the following structure (in this example, mapping the Unicode
values `U+17BB U+17C7` (ុះ) to the Private Use Area code `U+F19F`):

```json
{
  "map": [
    {
      "pua": "F19F",
      "str": "ុះ"
    },
    ...
  ]
}
```

* The `pua` field must be a single hex value, by convention in the PUA range
  starting at `U+F100`.
* The `str` field contains the codepoints that will be mapped to the PUA code;
  if `U+25CC` (◌, dotted circle) is specified on a key cap, it will be
  stripped before matching in the `&displayMap`, so `U+25CC` should not be
  included in `str`.
* Other fields are documented in the schema reference for the keyboard in the
  Keyman source at https://github.com/keymanapp/keyman/blob/master/common/schemas/displaymap/README.md

The file can be passed without modification to the [TODO: ____ font tool](http://example.com) to
generate a Kbd font. The font may need some manual editing as insertion of
dotted circle (`U+25CC`) as a base may not always be possible automatically, and
combined marks may not render as a cluster in some scenarios. The open source
tool [FontForge](https://fontforge.org) is suitable for making these kinds of
minor adjustments to the generated font.

`&displayMap` fonts and files are intended to be shared across multiple
keyboards that work with the same script. `kmc analyze osk-char-use` can scan
multiple keyboards at once when generating the file.

Using `&displayMap` means that the design-time model for the On Screen Keyboard
and Touch Layout can continue to use the correct Unicode values on the keycaps,
making the transformation to PUA characters only in the compilation process.

## Standard conventions for use of displayMaps

In the Keyman keyboards repository, the PUA range used should start at `U+9100`.

`&displayMap` JSON files should be named `Kbd<script>.json` where `<script>`
is a [4 letter script subtag](/developer/current-version/reference/bcp-47#toc-the-script-subtag),
for example `KbdKhmr.json`, and the corresponding font is named `KbdKhmr.ttf`
(with face name `KbdKhmr`). These fonts are intended only for use in visual
keyboards and touch layouts and generally will not be suitable for any other
use. An optional suffix to a font may be included, if appropriate, for example,
`KbdArab-Nastaliq.ttf` (face name `KbdArab-Nastaliq`).

## Example

```keyman
store(&displayMap) '../../../common/fonts/kbd/KbdKhmr.json'
```

## Platforms

The `&displayMap` store is used only in the compile process and the results are
applicable on all platforms.

<table class='platform'>
  <thead>
    <tr><th>Windows</th><th>macOS</th><th>Linux</th><th>Desktop web</th><th>Mobile web</th><th>iOS</th><th>Android</th></tr>
  </thead>
  <tbody>
    <tr><td>✔</td><td>✔</td><td>✔</td><td>✔</td><td>✔</td><td>✔</td><td>✔</td></tr>
  </tbody>
</table>

## See Also

* [`&visualKeyboard` store](visualkeyboard)
* [`&touchLayout` store](touchlayout)
* More background on the need for `&displayMap` can be found in [issue #9031](https://github.com/keymanapp/keyman/issues/9031).

## Version history

* Version 17.0: `&displayMap` support introduced. Keyboards must be compiled
  with v17 or later compiler, but the results will work in older versions of the
  compiler.